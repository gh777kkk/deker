<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.deker.cmm.mapper.CMMMapper">

    <select id="selectCode" parameterType="CMMConditions" resultType="CMM">
        SELECT      CODE        value
                ,   CODE_NM     label
        FROM CODE_DETAIL
        WHERE CODE_ID = #{codeId}
    </select>

    <update id="updateIds" parameterType="String">
        INSERT INTO IDS
        (TABEL_NAME, NEXT_ID)
        VALUES (#{tableName},0)
        ON DUPLICATE KEY UPDATE
        TABEL_NAME = #{tableName},
        NEXT_ID = NEXT_ID+1
    </update>

    <select id="selectIds" parameterType="String" resultType="Integer">
        SELECT NEXT_ID  nextId
        FROM IDS
        WHERE TABEL_NAME = #{tableName}
    </select>

    <insert id="insertImg" parameterType="ImgConditions">
        INSERT INTO IMAGE
        (
                IMG_ID
            ,   IMG_PATH
            ,   STRE_NM
            ,   IMG_NM
            ,   IMG_EXTENTION
            ,   FILE_SIZE
            ,   CREATE_ID
            ,   UPDATE_ID
        )
        VALUES
        (
                #{imgId}
            ,   #{imgPath}
            ,   #{streNm}
            ,   #{imgNm}
            ,   #{imgExtention}
            ,   #{fileSize}
            ,   #{memId}
            ,   #{memId}
        )
    </insert>

    <select id="selectImg" parameterType="String" resultType="Img">
        SELECT      IMG_PATH            imgPath
                ,   STRE_NM             streNm
                ,   IMG_NM              imgNm
                ,   IMG_EXTENTION       imgExtention
                ,   FILE_SIZE           fileSize
        FROM IMAGE
        WHERE IMG_ID = #{imgId}
    </select>




    <select id="getMenu" resultType="Menu">
        select m.MENU_NM AS menuName,
               m.MENU_URL AS menuUrl,
               m.MENU_ID AS menuId,
               m.MENU_PARENT AS menuParent,
               m.MENU_IMG_URL AS menuImgUrl
        from study_gh.MENU m, study_gh.MENU_AUTHORITY a
        where a.AUTHORITY_CODE = #{authorityCode} and a.MENU_ID = m.MENU_ID
    </select>


    <select id="getUserRole" resultType="String">
        select AUTHORITY_CODE
        from study_gh.AUTHORITY a
        where a.MEM_ID = #{memId}
    </select>

</mapper>

